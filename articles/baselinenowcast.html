<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Getting Started with baselinenowcast • baselinenowcast</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting Started with baselinenowcast">
<meta name="description" content="A quick start example demonstrating use of baselinenowcast">
<meta property="og:description" content="A quick start example demonstrating use of baselinenowcast">
<meta property="og:image" content="https://baselinenowcast.epinowcast.org/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">baselinenowcast</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/baselinenowcast.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/baselinenowcast.html">Getting started</a></li>
    <li><a class="dropdown-item" href="../articles/modular_workflow.html">Modular workflow demonstration</a></li>
    <li><a class="dropdown-item" href="../articles/model_definition.html">Mathematical model</a></li>
    <li><a class="dropdown-item" href="../articles/nomenclature.html">Nomenclature</a></li>
    <li><a class="dropdown-item" href="../articles/nssp_nowcast.html">A case study nowcasting applied to the U.S. National Syndromic Surveillance Program (NSSP) data</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epinowcast/baselinenowcast/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Getting Started with baselinenowcast</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/epinowcast/baselinenowcast/blob/main/vignettes/baselinenowcast.Rmd" class="external-link"><code>vignettes/baselinenowcast.Rmd</code></a></small>
      <div class="d-none name"><code>baselinenowcast.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Incomplete reporting of epidemiological data at recent times can result in case count data that is right-truncated.
Right-truncated case counts can be misleading to interpret at face-value, as they will typically show a decline in the number of reported observations in the most recent time points.
These are the time points where the highest proportion of the data has yet to be observed in the dataset.</p>
<p>The imputation of the cases that will eventually be observed up until the current time is referred to as a nowcast.</p>
<p>A number of methods have been developed to nowcast epidemiological case count data.</p>
<p>The purpose of <code>baselinenowcast</code> is to provide a nowcast computed directly from the most recent observations to estimate a delay distribution empirically, and apply that to the partially observed data to generate a nowcast.</p>
<p>In the below section, we will describe an example of a nowcasting problem, and demonstrate how to use the <code><a href="../reference/baselinenowcast.html">baselinenowcast()</a></code> function to estimate a delay distribution from the data and apply that estimate to generate a probabilistic nowcast.
This function chains together a series of nowcasting steps.
For an example that walks through the low-level functionality applied to this same epidemiological question, see the <a href="modular_workflow.html">modular workflow</a> vignette.
In future vignettes, we will demonstrate examples of how to create more complex model permutations.
More details on the mathematical methods are provided in the <a href="model_definition.html">mathematical model</a> vignette.</p>
</div>
<div class="section level2">
<h2 id="packages">Packages<a class="anchor" aria-label="anchor" href="#packages"></a>
</h2>
<p>As well as the <code>baselinenowcast</code> package this vignette also uses <code>epinowcast</code>, <code>ggplot2</code>, <code>tidyr</code>, and <code>dplyr</code>.
For <code>baselinenowcast</code>, see the <a href="https://github.com/epinowcast/baselinenowcast#installation" class="external-link">installation instructions</a>.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html" class="external-link">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span></span>
<span>  collapse <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  comment <span class="op">=</span> <span class="st">"#&gt;"</span></span>
<span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/epinowcast/baselinenowcast" class="external-link">baselinenowcast</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span></code></pre></div>
</details>
</div>
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<p>Nowcasting of right-truncated case counts involves the estimation of reporting delays for recently reported data.
For this, we need case counts indexed both by when they were diagnosed (often called the “reference date”) and by when they were reported (i.e. when administratively recorded via public health surveillance; often called “report date”).
The difference between the reference date and the report date is the reporting delay.
For this quick start, we use daily level data from the <a href="https://github.com/KITmetricslab/hospitalization-nowcast-hub/wiki/Truth-data#role-an-definition-of-the-seven-day-hospitalization-incidence" class="external-link">Robert Koch Institute via the Germany Nowcasting hub</a>.
These data represent hospital admission counts by date of positive test and date of test report in Germany up to October 1, 2021.</p>
<p>We will filter the data to just look at the national-level data, for all age groups.
We will pretend that we are making a nowcast as of August 1, 2021, therefore we will exclude all reference dates and report dates from before that date.
<code>germany_covid19_hosp</code> is provided as package data, see <code><a href="../reference/germany_covid19_hosp.html">?germany_covid19_hosp</a></code> for details.
In this example, we will focus on the cases for all of Germany (“DE”) summed across all age groups (“00+”).
We’ll start by preparing the data for nowcasting and evaluation by removing all reference dates beyond the nowcast date and report dates beyond the date we will use to evaluate our nowcast performance.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nowcast_date</span> <span class="op">&lt;-</span> <span class="st">"2021-08-01"</span></span>
<span><span class="va">eval_date</span> <span class="op">&lt;-</span> <span class="st">"2021-10-01"</span></span>
<span></span>
<span><span class="va">target_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">germany_covid19_hosp</span>,</span>
<span>  <span class="va">location</span> <span class="op">==</span> <span class="st">"DE"</span>, <span class="va">age_group</span> <span class="op">==</span> <span class="st">"00+"</span>,</span>
<span>  <span class="va">report_date</span> <span class="op">&lt;=</span> <span class="va">eval_date</span>,</span>
<span>  <span class="va">reference_date</span> <span class="op">&lt;=</span> <span class="va">nowcast_date</span></span>
<span><span class="op">)</span></span></code></pre></div>
</details><p>Next we can plot both the “initial reports” by taking the sum of the cases at each reference date excluding all reports after the nowcast date, and compare that to what we will eventually observe as of the latest date in the complete dataset (data available through October 1, 2021).
Let’s first take the sum of the cases at each reference date from the complete dataset, which represents the “final” case counts using the data available through October 1, 2021.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">latest_data</span> <span class="op">&lt;-</span> <span class="va">target_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">reference_date</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>final_count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</details><p>Next, let’s get a dataset of what we would have had available as of the nowcast date, which we obtain by excluding all report dates after the nowcast date.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">observed_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">target_data</span>,</span>
<span>  <span class="va">report_date</span> <span class="op">&lt;=</span> <span class="va">nowcast_date</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">observed_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">#&gt;   reference_date location age_group delay count report_date</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2021-04-06     DE       00+           0   149 2021-04-06 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2021-04-06     DE       00+           1   140 2021-04-07 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2021-04-06     DE       00+           2    61 2021-04-08 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2021-04-06     DE       00+           3    52 2021-04-09 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 2021-04-06     DE       00+           4    36 2021-04-10 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2021-04-06     DE       00+           5     8 2021-04-11</span></span></code></pre></div>
</details><p>We refer to the “initial reports” as the sum of the cases at each reference date as they were available as of the nowcast date.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">initial_reports</span> <span class="op">&lt;-</span> <span class="va">observed_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">reference_date</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>initial_count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</details><p>We will make a plot comparing the initial reports to the later observed final number of confirmed cases at each reference date.</p>
<details><summary>
Click to expand code to create the plot of the latest data
</summary><details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">initial_reports</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">reference_date</span>, y <span class="op">=</span> <span class="va">initial_count</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"darkred"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">latest_data</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">reference_date</span>, y <span class="op">=</span> <span class="va">final_count</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Reference date"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Confirmed admissions"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>trans <span class="op">=</span> <span class="st">"log10"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Comparing initially reported and later observed cases"</span><span class="op">)</span></span></code></pre></div>
</details></details><details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_data</span></span></code></pre></div>
</details><p><img src="baselinenowcast_files/figure-html/unnamed-chunk-6-1.png"><!-- --></p>
<p>The red line shows the total number of confirmed admissions on each reference date, across all delays, using the data available as of August 1, 2021.
It demonstrates the characteristic behaviour of right-truncation.
This is because we have not yet observed the data with longer delays at recent time points.
The black line shows the total number of confirmed admissions on each reference date as of October 1, 2021.</p>
<p>Our task will be to estimate, from the data available up until August 1, 2021, the “final” number of cases at each reference date.</p>
</div>
<div class="section level2">
<h2 id="pre-processing">Pre-processing<a class="anchor" aria-label="anchor" href="#pre-processing"></a>
</h2>
<p>In order to compute a nowcast for this data, we will need to start by creating what we call a reporting triangle.
See the <a href="nomenclature.html">nomenclature</a> vignette for more details on the structure and naming of different components used in the package.</p>
<p>The entries in the reporting triangle represent the number of new cases assigned to that reference time point with a particular delay, with entries in the bottom right of the triangle missing as the data reported with longer delays has yet to be observed for recent reference times.
The reporting triangle will be used to estimate the delay distribution, or the proportion of the final number of cases reported on a particular delay.</p>
<p>In this example, we will both fit our delay distribution, and apply it to generate a nowcast matrix using the same data, the national level data from Germany for all age groups.</p>
<p>We recommend choosing the maximum delay and number of historical observations based on an exploratory data analysis, as these specifications will change significantly depending on the dataset.
See the <a href="nssp_nowcast.html">NSSP nowcast</a> for an example of an exploratory data analysis used to identify the maximum delay.
Here we will set the maximum delay to 30 days.</p>
<p>Empirical data outside this delay window will not be used for training.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">max_delay</span> <span class="op">&lt;-</span> <span class="fl">30</span></span></code></pre></div>
</details><p>Next, we will specify the amount of training volume used to fit the model as a function of the maximum delay, and the proportion of the total training volume used for delay estimation (with the remainder being used for uncertainty estimation).
Internally within <code><a href="../reference/baselinenowcast.html">baselinenowcast()</a></code> we will call, <code><a href="../reference/allocate_reference_times.html">allocate_reference_times()</a></code> with these arguments.
We’ll us the default settings for this function here, which uses 3 times the maximum delay for the total training volume with 50% used for delay estimation.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scale_factor</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">prop_delay</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span></code></pre></div>
</details><p>Next we obtain a <code>reporting_triangle</code> using the <code><a href="../reference/as_reporting_triangle.html">as_reporting_triangle()</a></code> function, which expects a data.frame with case counts indexed by reference date and report date.
This function computes the delay between the reference and report date and pivots the data from long to wide, so that the rows are reference times and the columns indicate the delay between the reference and report date, and the entries indicate the incident case counts.
This also validates that the data is in the correct format and runs pre-processing to fill in any missing dates, see <code><a href="../reference/as_reporting_triangle.data.frame.html">?as_reporting_triangle.data.frame</a></code> and <code><a href="../reference/reporting_triangle-class.html">?reporting_triangle</a></code> for more details on required inputs and the format of the <code>reporting_triangle</code> object.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rep_tri_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_reporting_triangle.html">as_reporting_triangle</a></span><span class="op">(</span><span class="va">observed_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Using max_delay = 40 from data</span></span></code></pre></div>
</details><p>Let’s look at the reporting triangle object we’ve created:</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rep_tri_full</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Reporting Triangle</span></span></span>
<span><span class="co">#&gt; Delays unit: days</span></span>
<span><span class="co">#&gt; Reference dates: 2021-04-06 to 2021-08-01</span></span>
<span><span class="co">#&gt; Max delay: 40</span></span>
<span><span class="co">#&gt; Structure: 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Showing last 10 of 118 rows</span></span>
<span><span class="co">#&gt; Showing first 10 of 41 columns</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             0  1  2  3  4  5  6  7  8  9</span></span>
<span><span class="co">#&gt; 2021-07-23 30 12  4  1 10  6  0  2  2  1</span></span>
<span><span class="co">#&gt; 2021-07-24 31  8  4  9  8  2  5  2  1 NA</span></span>
<span><span class="co">#&gt; 2021-07-25  8  4 14  8  6  5  1  3 NA NA</span></span>
<span><span class="co">#&gt; 2021-07-26  9  6  2  3  0  0  0 NA NA NA</span></span>
<span><span class="co">#&gt; 2021-07-27 35 11  6  4  4  1 NA NA NA NA</span></span>
<span><span class="co">#&gt; 2021-07-28 51 28 25  3  5 NA NA NA NA NA</span></span>
<span><span class="co">#&gt; 2021-07-29 47 37  9  2 NA NA NA NA NA NA</span></span>
<span><span class="co">#&gt; 2021-07-30 36 20  2 NA NA NA NA NA NA NA</span></span>
<span><span class="co">#&gt; 2021-07-31 38 16 NA NA NA NA NA NA NA NA</span></span>
<span><span class="co">#&gt; 2021-08-01  7 NA NA NA NA NA NA NA NA NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Use print(x, n_rows = NULL, n_cols = NULL) to see all data</span></span></code></pre></div>
</details><p>And we can get a summary of it:</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">rep_tri_full</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Reporting Triangle Summary</span></span></span>
<span><span class="co">#&gt; Dimensions: 118 x 41</span></span>
<span><span class="co">#&gt; Reference period: 2021-04-06 to 2021-08-01</span></span>
<span><span class="co">#&gt; Max delay: 40 days</span></span>
<span><span class="co">#&gt; Structure: 1</span></span>
<span><span class="co">#&gt; Most recent complete date: 2021-06-22 (67 cases)</span></span>
<span><span class="co">#&gt; Dates requiring nowcast: 40 (complete: 78)</span></span>
<span><span class="co">#&gt; Rows with negatives: 0</span></span>
<span><span class="co">#&gt; Zeros: 1278 (31.8% of non-NA values)</span></span>
<span><span class="co">#&gt; Zeros per row summary:</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;    0.00    4.00    8.00   10.83   19.00   33.00</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Mean delay summary (complete rows):</span></span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;   2.525   4.857   5.650   5.469   6.174   7.678</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">99% quantile delay (complete rows):</span></span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;   17.00   33.00   35.00   34.31   37.00   40.00</span></span></code></pre></div>
</details><p>We can see the maximum delay is set to the maximum observed delay, which in some cases will be a lot larger than the delays we want to model.
We strongly recommend using the <code><a href="../reference/truncate_to_delay.html">truncate_to_delay()</a></code> or <code><a href="../reference/truncate_to_quantile.html">truncate_to_quantile()</a></code> functions to set the maximum delay in your nowcasting problem.
Choosing too large a maximum delay will mean that there is less data, or potentially insufficient data, available for estimating uncertainty from retrospective nowcast errors.
For this analysis, we want to limit our reporting triangle to a maximum delay of 30 days using <code><a href="../reference/truncate_to_delay.html">truncate_to_delay()</a></code>:</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rep_tri</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/truncate_to_delay.html">truncate_to_delay</a></span><span class="op">(</span><span class="va">rep_tri_full</span>, max_delay <span class="op">=</span> <span class="va">max_delay</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Truncating from max_delay = 40 to 30.</span></span></code></pre></div>
</details><p>Let’s check the truncated triangle:</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rep_tri</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Reporting Triangle</span></span></span>
<span><span class="co">#&gt; Delays unit: days</span></span>
<span><span class="co">#&gt; Reference dates: 2021-04-06 to 2021-08-01</span></span>
<span><span class="co">#&gt; Max delay: 30</span></span>
<span><span class="co">#&gt; Structure: 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Showing last 10 of 118 rows</span></span>
<span><span class="co">#&gt; Showing first 10 of 31 columns</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             0  1  2  3  4  5  6  7  8  9</span></span>
<span><span class="co">#&gt; 2021-07-23 30 12  4  1 10  6  0  2  2  1</span></span>
<span><span class="co">#&gt; 2021-07-24 31  8  4  9  8  2  5  2  1 NA</span></span>
<span><span class="co">#&gt; 2021-07-25  8  4 14  8  6  5  1  3 NA NA</span></span>
<span><span class="co">#&gt; 2021-07-26  9  6  2  3  0  0  0 NA NA NA</span></span>
<span><span class="co">#&gt; 2021-07-27 35 11  6  4  4  1 NA NA NA NA</span></span>
<span><span class="co">#&gt; 2021-07-28 51 28 25  3  5 NA NA NA NA NA</span></span>
<span><span class="co">#&gt; 2021-07-29 47 37  9  2 NA NA NA NA NA NA</span></span>
<span><span class="co">#&gt; 2021-07-30 36 20  2 NA NA NA NA NA NA NA</span></span>
<span><span class="co">#&gt; 2021-07-31 38 16 NA NA NA NA NA NA NA NA</span></span>
<span><span class="co">#&gt; 2021-08-01  7 NA NA NA NA NA NA NA NA NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Use print(x, n_rows = NULL, n_cols = NULL) to see all data</span></span></code></pre></div>
</details><details><summary>
Click to expand code to create the plot of the reporting triangle
</summary><details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">triangle_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">rep_tri</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">reference_date</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_triangle</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>  <span class="va">triangle_df</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">delay</span>, y <span class="op">=</span> <span class="va">time</span>, fill <span class="op">=</span> <span class="va">count</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"white"</span>, high <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Reporting triangle"</span>, x <span class="op">=</span> <span class="st">"Delay"</span>, y <span class="op">=</span> <span class="st">"Time"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_reverse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</details></details><details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_triangle</span></span></code></pre></div>
</details><p><img src="baselinenowcast_files/figure-html/unnamed-chunk-15-1.png"><!-- -->
Here, the grey indicates matrix elements that are <code>NA</code>, which we would expect to be the case in the bottom right portion of the reporting triangle where the counts have yet to be observed.</p>
</div>
<div class="section level2">
<h2 id="run-the-baselinenowcast-workflow">Run the <code>baselinenowcast</code> workflow<a class="anchor" aria-label="anchor" href="#run-the-baselinenowcast-workflow"></a>
</h2>
<p>To generate a nowcast from a reporting triangle, we can use the <code><a href="../reference/baselinenowcast.html">baselinenowcast()</a></code> function.
This function chains together the following nowcasting steps:
1. Allocates the reference times (<code><a href="../reference/allocate_reference_times.html">allocate_reference_times()</a></code>) used for model fitting for both delay and uncertainty estimation, given the <code>scale_factor</code> and <code>prop_delay</code> as described above, with the values above also used as defaults in the absence of user specification.
2. Estimates a delay distribution from the reporting triangle (<code><a href="../reference/estimate_delay.html">estimate_delay()</a></code>), using the number of reference times allocated for delay estimation.
3. Generates a point nowcast (<code><a href="../reference/apply_delay.html">apply_delay()</a></code>) from the reporting triangle and delay distribution.
4. Estimates the uncertainty parameters (<code><a href="../reference/estimate_uncertainty_retro.html">estimate_uncertainty_retro()</a></code>) using retrospective nowcast errors.
5. Sample from the uncertainty model to generate probabilistic draws of the nowcast (<code><a href="../reference/sample_nowcasts.html">sample_nowcasts()</a></code>).</p>
<p>See the documentation for each of these functions for more details on the specific workflow step, and the documentation for <code><a href="../reference/baselinenowcast.reporting_triangle.html">?baselinenowcast.reporting_triangle</a></code> for input options.
In this example, we will demonstrate how to specify the reference time allocation and the number of probabilistic draws to include, and will otherwise use the default specifications.
A point nowcast can be returned by specifying <code>output_type = "point"</code>.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nowcast_draws_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/baselinenowcast.html">baselinenowcast</a></span><span class="op">(</span></span>
<span>  <span class="va">rep_tri</span>,</span>
<span>  scale_factor <span class="op">=</span> <span class="va">scale_factor</span>,</span>
<span>  prop_delay <span class="op">=</span> <span class="va">prop_delay</span>,</span>
<span>  draws <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span></code></pre></div>
</details><p>The <code>nowcast_draws_df</code> is a data.frame of the class <code>baselinenowcast_df</code> (see <code><a href="../reference/baselinenowcast_df-class.html">?baselinenowcast_df</a></code> for more details).
It contains probabilistic draws of estimate of the final number of cases on each reference date.</p>
</div>
<div class="section level2">
<h2 id="visualizing-the-nowcast">Visualizing the nowcast<a class="anchor" aria-label="anchor" href="#visualizing-the-nowcast"></a>
</h2>
<p>We’ll want to compare the nowcasts to both the initial reports and the eventually observed case counts.
We can join both datasets to the probabilistic nowcasts by the reference date.
Join the nowcasts, data as of the nowcast date, and the final data.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_with_nowcast_draws_df</span> <span class="op">&lt;-</span> <span class="va">nowcast_draws_df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">latest_data</span>, by <span class="op">=</span> <span class="st">"reference_date"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">initial_reports</span>, by <span class="op">=</span> <span class="st">"reference_date"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">obs_with_nowcast_draws_df</span><span class="op">)</span></span>
<span><span class="co">#&gt;   pred_count reference_date draw output_type final_count initial_count</span></span>
<span><span class="co">#&gt; 1        609     2021-04-06    1     samples         615           615</span></span>
<span><span class="co">#&gt; 2        609     2021-04-06    2     samples         615           615</span></span>
<span><span class="co">#&gt; 3        609     2021-04-06    3     samples         615           615</span></span>
<span><span class="co">#&gt; 4        609     2021-04-06    4     samples         615           615</span></span>
<span><span class="co">#&gt; 5        609     2021-04-06    5     samples         615           615</span></span>
<span><span class="co">#&gt; 6        609     2021-04-06    6     samples         615           615</span></span></code></pre></div>
</details><details><summary>
Click to expand code to create the plot of the probabilistic nowcast
</summary><details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">combined_data</span> <span class="op">&lt;-</span> <span class="va">obs_with_nowcast_draws_df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">reference_date</span>, <span class="va">initial_count</span>, <span class="va">final_count</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">initial_count</span>, <span class="va">final_count</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"type"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"count"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">type</span> <span class="op">==</span> <span class="st">"initial_count"</span> <span class="op">~</span> <span class="st">"Initial reports"</span>,</span>
<span>    <span class="va">type</span> <span class="op">==</span> <span class="st">"final_count"</span> <span class="op">~</span> <span class="st">"Final observed data"</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot with draws for nowcast only</span></span>
<span><span class="va">plot_prob_nowcast</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Add nowcast draws as thin gray lines</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">obs_with_nowcast_draws_df</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">reference_date</span>, y <span class="op">=</span> <span class="va">pred_count</span>, group <span class="op">=</span> <span class="va">draw</span>,</span>
<span>      color <span class="op">=</span> <span class="st">"Nowcast draw"</span>, linewidth <span class="op">=</span> <span class="st">"Nowcast draw"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Add observed data and final data once</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">combined_data</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">reference_date</span>,</span>
<span>      y <span class="op">=</span> <span class="va">count</span>,</span>
<span>      color <span class="op">=</span> <span class="va">type</span>,</span>
<span>      linewidth <span class="op">=</span> <span class="va">type</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"Nowcast draw"</span> <span class="op">=</span> <span class="st">"gray"</span>,</span>
<span>      <span class="st">"Initial reports"</span> <span class="op">=</span> <span class="st">"darkred"</span>,</span>
<span>      <span class="st">"Final observed data"</span> <span class="op">=</span> <span class="st">"black"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    name <span class="op">=</span> <span class="st">""</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_linewidth_manual</a></span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"Nowcast draw"</span> <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>      <span class="st">"Initial reports"</span> <span class="op">=</span> <span class="fl">1</span>,</span>
<span>      <span class="st">"Final observed data"</span> <span class="op">=</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span>,</span>
<span>    name <span class="op">=</span> <span class="st">""</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>trans <span class="op">=</span> <span class="st">"log10"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Reference date"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Hospital admissions"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Comparison of admissions as of the nowcast date, later observed counts, \n and probabilistic nowcasted counts"</span><span class="op">)</span> <span class="co"># nolint</span></span></code></pre></div>
</details></details><details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_prob_nowcast</span></span></code></pre></div>
</details><p><img src="baselinenowcast_files/figure-html/unnamed-chunk-19-1.png"><!-- -->
Gray lines indicate the probabilistic nowcast draws, which are a combination of the already observed data at each reference date and the predicted nowcast draws at each reference date.
Black lines show the “final” data from October 1, 2021.</p>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>In this vignette we used <code>baselinenowcast</code> functions to generate a probabilistic nowcast from a dataframe of incident COVID-19 hospital admissions indexed by reference date and report date in Germany.
To do this, we first converted the input data to a <code>reporting_triangle</code> and then called the <code><a href="../reference/baselinenowcast.html">baselinenowcast()</a></code> function which ran each of the steps of our nowcasting workflow.
As a final step, we compared our nowcasts of the final cases to the eventual final observed cases and the initially reported case counts.</p>
<p>The <code><a href="../reference/baselinenowcast.html">baselinenowcast()</a></code> function also directly supports nowcasting for multiple strata and common tasks for handling multiple strata such as sharing delay and uncertainty estimates across strata.
See the documentation for <code><a href="../reference/baselinenowcast.data.frame.html">?baselinenowcast.data.frame</a></code> for more details.</p>
<p>Alternatively, you might be interested in building a more customisable nowcasting workflow.
This is supported by our modular workflow which enables a pipeline-based approach using low-level functions.
For an example of walking through this same nowcasting problem using the low-level functions directly, see the <a href="modular_workflow.html">modular workflow</a> vignette.</p>
<p>In this vignette we use the package’s default settings to specify the model, but the optimal settings will depend on the context and its important to tune the model for your dataset and needs.
The user has a number of choices in how to specify the model, such as:</p>
<ul>
<li>the amount of training data to use for delay or uncertainty estimation</li>
<li>the choice of observation model</li>
<li>how to stratify nowcasts e.g. by age group or weekday</li>
<li>whether to borrow estimates from across different strata</li>
</ul>
<p>In our <a href="https://wellcomeopenresearch.org/articles/10-614/v1" class="external-link">publication</a> we show examples using the various model specifications to produce and evaluate the performance of age-group specific nowcasts of COVID-19 in Germany and norovirus cases in England.
Here’s a <a href="https://github.com/epinowcast/baselinenowcast-paper" class="external-link">link</a> to the code used to generate those nowcasts if interested in doing something similar for your own setting.</p>
<p>We encourage users to test the performance of different specifications of their model, ideally by producing nowcasts from different model specifications for a range of past nowcast dates, using the data that would have been available as of the past nowcast date, and comparing those nowcasts to later observed data.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kaitlyn Johnson, Emily Tyszka, Johannes Bracher, Sebastian Funk, <a href="https://www.samabbott.co.uk/" class="external-link">Sam Abbott</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
