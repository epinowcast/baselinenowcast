<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Mathematical methods for `baselinenowcast` • baselinenowcast</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Mathematical methods for `baselinenowcast`">
<meta name="description" content="Description of mathematical methods used in the package">
<meta property="og:description" content="Description of mathematical methods used in the package">
<meta property="og:image" content="https://baselinenowcast.epinowcast.org/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">baselinenowcast</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.1000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/baselinenowcast.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/baselinenowcast.html">Getting started</a></li>
    <li><a class="dropdown-item" href="../articles/model_definition.html">Mathematical model</a></li>
    <li><a class="dropdown-item" href="../articles/nomenclature.html">Nomenclature</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epinowcast/baselinenowcast/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Mathematical methods for `baselinenowcast`</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/epinowcast/baselinenowcast/blob/main/vignettes/model_definition.Rmd" class="external-link"><code>vignettes/model_definition.Rmd</code></a></small>
      <div class="d-none name"><code>model_definition.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The <code>baselinenowcast</code> model, initially developed as a
reference for the COVID-19 hospital admissions nowcasting challenge in
Germany (2021-2022, <a href="https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1011394" class="external-link">Wolffram
et al</a>, utilises reporting triangles of preliminary case counts and
their delays. It applies a multiplicative approach, using empirically
observed historical delay distributions to estimate yet-to-be-observed
cases. Users can specify whether delay distributions are estimated from
the latest data, fully observed past data, or data from different
strata. The model produces point estimates of nowcasts by “filling in”
the reporting triangle. Probabilistic nowcasts are generated using a
negative binomial model with means from the point nowcast and dispersion
parameters estimated from past nowcast errors. The dispersion parameters
can also be flexibly sourced from current data, historical data, or
alternative settings.</p>
<div class="section level3">
<h3 id="notation">Notation<a class="anchor" aria-label="anchor" href="#notation"></a>
</h3>
<p>We denote <span class="math inline">\(X_{t,d}, d = 0, .., D\)</span>
as the number of cases occurring on time <span class="math inline">\(t\)</span> which appear in the dataset with a
delay of <span class="math inline">\(d\)</span>. For example, a delay
<span class="math inline">\(d = 0\)</span> means that a case occurring
on day <span class="math inline">\(t\)</span> arrived in the dataset on
day <span class="math inline">\(t\)</span>, or on what is considered to
be the first possible report date in practice. We only consider cases
reporting within a maximum delay <span class="math inline">\(D\)</span>.
The number of cases reporting for time <span class="math inline">\(t\)</span> with a delay of at most <span class="math inline">\(d\)</span> can be written as:</p>
<p><span class="math display">\[X_{t, \le d} = \sum_{i=0}^d X_{t,i}
\]</span></p>
<p>Such that <span class="math inline">\(X_t = X_{t, \le D}\)</span> is
the “final” number of reported cases on time <span class="math inline">\(t\)</span>. Conversely, for <span class="math inline">\(d &lt; D\)</span></p>
<p><span class="math display">\[X_{t,&gt;d} = \sum_{i = d+1} ^{D}
X_{t,i}\]</span></p>
<p>is the number of cases still missing after <span class="math inline">\(d\)</span> delay. We refer to <span class="math inline">\(X_t\)</span> to describe a random variable, <span class="math inline">\(x_t\)</span> for the corresponding observation,
and <span class="math inline">\(\hat{x}_t\)</span> for an
estimated/imputed value. The matrix of <span class="math inline">\(x_{t,d}\)</span> available at a given time <span class="math inline">\(t^*\)</span> is referred to as a reporting matrix.
In the case where all <span class="math inline">\(t+d&gt;t^*\)</span>
have yet to be observed (e.g. <span class="math inline">\(t^*\)</span>
is the current time), this reporting matrix is referred to as the
reporting triangle, with all values in the bottom right corner of the
triangle being missing, except for the first entry at <span class="math inline">\(x_{t=t*, d = 0}\)</span>. For a description of the
nowcasting terms being used in this document (e.g. reporting triangle)
and their corresponding abbreviations in the package, please consult the
<a href="nomenclature.html">nowcasting nomenclature</a> vignette.</p>
<table style="width:100%;" class="table">
<colgroup>
<col width="14%">
<col width="14%">
<col width="14%">
<col width="14%">
<col width="14%">
<col width="14%">
<col width="14%">
</colgroup>
<thead><tr class="header">
<th></th>
<th><span class="math inline">\(d = 0\)</span></th>
<th><span class="math inline">\(d = 1\)</span></th>
<th><span class="math inline">\(d=2\)</span></th>
<th><span class="math inline">\(...\)</span></th>
<th><span class="math inline">\(d= D-1\)</span></th>
<th><span class="math inline">\(d= D\)</span></th>
</tr></thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(t=1\)</span></td>
<td><span class="math inline">\(x_{1,0}\)</span></td>
<td><span class="math inline">\(x_{1,1}\)</span></td>
<td><span class="math inline">\(x_{1,2}\)</span></td>
<td><span class="math inline">\(...\)</span></td>
<td><span class="math inline">\(x_{1,D-1}\)</span></td>
<td><span class="math inline">\(x_{1, D}\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(t=2\)</span></td>
<td><span class="math inline">\(x_{2,0}\)</span></td>
<td><span class="math inline">\(x_{2,1}\)</span></td>
<td><span class="math inline">\(x_{2,2}\)</span></td>
<td><span class="math inline">\(...\)</span></td>
<td><span class="math inline">\(x_{2,D-1}\)</span></td>
<td><span class="math inline">\(x_{2, D}\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(t=3\)</span></td>
<td><span class="math inline">\(x_{3,0}\)</span></td>
<td><span class="math inline">\(x_{3,1}\)</span></td>
<td><span class="math inline">\(x_{3,2}\)</span></td>
<td><span class="math inline">\(...\)</span></td>
<td><span class="math inline">\(x_{3,D-1}\)</span></td>
<td><span class="math inline">\(x_{3, D}\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(...\)</span></td>
<td><span class="math inline">\(...\)</span></td>
<td><span class="math inline">\(...\)</span></td>
<td><span class="math inline">\(...\)</span></td>
<td><span class="math inline">\(...\)</span></td>
<td><span class="math inline">\(...\)</span></td>
<td><span class="math inline">\(...\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(t=t^*-1\)</span></td>
<td><span class="math inline">\(x_{t^*-1,0}\)</span></td>
<td><span class="math inline">\(x_{t^*-1,1}\)</span></td>
<td><span class="math inline">\(x_{t^*-1,,2}\)</span></td>
<td><span class="math inline">\(...\)</span></td>
<td><span class="math inline">\(x_{t^*-1,,D-1}\)</span></td>
<td><span class="math inline">\(x_{t^*-1,D}\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(t=t^*\)</span></td>
<td><span class="math inline">\(x_{t^*,0}\)</span></td>
<td><span class="math inline">\(x_{t^*,1}\)</span></td>
<td><span class="math inline">\(x_{t^*,2}\)</span></td>
<td><span class="math inline">\(...\)</span></td>
<td><span class="math inline">\(x_{t^*,D-1}\)</span></td>
<td><span class="math inline">\(x_{t^*, D}\)</span></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="point-estimate-of-the-delay-distribution">Point estimate of the delay distribution<a class="anchor" aria-label="anchor" href="#point-estimate-of-the-delay-distribution"></a>
</h2>
<div class="section level3">
<h3 id="estimate-of-the-delay-distribution-from-a-reporting-matrix">Estimate of the delay distribution from a reporting matrix<a class="anchor" aria-label="anchor" href="#estimate-of-the-delay-distribution-from-a-reporting-matrix"></a>
</h3>
<p>We can use a reporting matrix to compute an empirical estimate of the
delay distribution, <span class="math inline">\(\pi(d)\)</span>. The
empirical delay distribution, <span class="math inline">\(\pi(d)\)</span> can be computed directly from the
reporting matrix <span class="math inline">\(X\)</span></p>
<p><span class="math display">\[
\pi(d)= \frac{\sum_{t=1}^{t=t^*} X_{t,d}}{\sum_{d'=0}^{D}
\sum_{t=1}^{t=t^*} X_{t,d'}}
\]</span></p>
<p>Where the numerator is the sum of all the observations across
reference times <span class="math inline">\(t\)</span> for a particular
delay <span class="math inline">\(d\)</span> of interest, and the
denominator is the sum across all reference times <span class="math inline">\(t\)</span> and indexed delays in the reporting
matrix <span class="math inline">\(d'\)</span>.</p>
</div>
<div class="section level3">
<h3 id="estimate-of-the-delay-distribution-from-a-reporting-triangle">Estimate of the delay distribution from a reporting triangle<a class="anchor" aria-label="anchor" href="#estimate-of-the-delay-distribution-from-a-reporting-triangle"></a>
</h3>
<p>In the case where we have missing values in the bottom right (i.e. we
have a reporting triangle), we need to use the multiplicative model to
generate a point nowcast matrix containing a mixture of observed and
imputed values. Then we can compute the delay distribution as described
above for the reporting matrix case.</p>
<p>The multiplicative model works by iteratively “filling in” the
reporting triangle starting from the bottom left, and moving column by
column from left to right until the bottom right of the triangle is
filled in.</p>
<div class="float">
<img src="../reference/figures/schematic_fig.png" alt="Visual description of the iterative “completing” of the reporting triangle, moving from left to right and bottom to top. In this cases, we are imputing x_{t=6, d = 2} and x_{t=5, d= 2} assuming that the ratio between x_{t=1:4, d = 2} (block top), and x_{t=1:4, d=0:1} (block top left) holds for for x_{t=5:6, d = 2} (block bottom) and x_{t=5:6, d = 0:1} (block bottom left). In this example, \hat{x}_{t=6, d = 1} has already been imputed using the same approach, and we treat it as known going forward. This process is repeated across the reporting triangle to estimate all values outlined in the dashed lines."><div class="figcaption">Visual description of the iterative “completing”
of the reporting triangle, moving from left to right and bottom to top.
In this cases, we are imputing <span class="math inline">\(x_{t=6, d =
2}\)</span> and <span class="math inline">\(x_{t=5, d= 2}\)</span>
assuming that the ratio between <span class="math inline">\(x_{t=1:4, d
= 2}\)</span> (block top), and <span class="math inline">\(x_{t=1:4,
d=0:1}\)</span> (block top left) holds for for <span class="math inline">\(x_{t=5:6, d = 2}\)</span> (block bottom) and <span class="math inline">\(x_{t=5:6, d = 0:1}\)</span> (block bottom left).
In this example, <span class="math inline">\(\hat{x}_{t=6, d =
1}\)</span> has already been imputed using the same approach, and we
treat it as known going forward. This process is repeated across the
reporting triangle to estimate all values outlined in the dashed
lines.</div>
</div>
<p>The method requires at least one observation, at delay <span class="math inline">\(d=0\)</span> for the most recent reference time,
located at the bottom left of the reporting triangle in Figure
@ref(fig:squares) above. The method assumes that the values at each
delay <span class="math inline">\(d\)</span> for the recent times, <span class="math inline">\(t\)</span>, will consist of the same proportion of
the values previously reported for earlier times <span class="math inline">\(t\)</span>. To fill in the missing values for each
column <span class="math inline">\(d\)</span>, we sum over the rectangle
of completely observed reference dates for all <span class="math inline">\(d-1\)</span> columns (block top left) and sum over
the column of completely observed reference dates for all of the entries
in column <span class="math inline">\(d\)</span> (block left). The ratio
of these two sums is assumed to be the same in the missing entries in
column <span class="math inline">\(d\)</span>, so we use the entries
observed up to <span class="math inline">\(d-1\)</span> for each
incomplete reference date (block bottom left), and scale by this ratio
to get the missing entries in column <span class="math inline">\(d\)</span>. This process is repeated for each
delay from <span class="math inline">\(d\)</span> up to the maximum
delay <span class="math inline">\(D\)</span>. At each iteration an
additional reference time entry is computed as the delay <span class="math inline">\(d\)</span> increases.</p>
<p>The delay distribution is then estimated from the filled in reporting
matrix, using the same algorithm as described above for the case of the
complete reporting square.</p>
<p>The <code><a href="../reference/get_delay_estimate.html">get_delay_estimate()</a></code> function ingests either a
reporting matrix, an incomplete reporting matrix, or a reporting
triangle and uses the last <code>n</code> rows to compute an empirical
delay probability mass function (returning a simplex vector indexed
starting at delay 0).</p>
</div>
</div>
<div class="section level2">
<h2 id="generation-of-a-point-nowcast-matrix-from-a-delay-distribution-and-a-reporting-triangle">Generation of a point nowcast matrix from a delay distribution and a
reporting triangle<a class="anchor" aria-label="anchor" href="#generation-of-a-point-nowcast-matrix-from-a-delay-distribution-and-a-reporting-triangle"></a>
</h2>
<p>To “fill in” the reporting triangle from the delay distribution, we
need to estimate the expected total number of eventual observed cases
<span class="math inline">\(\hat{x}_t\)</span>, for each reference time
<span class="math inline">\(t\)</span>. Let <span class="math inline">\(z\)</span> be the sum over all delays <span class="math inline">\(d\)</span> that have already been observed (up
until <span class="math inline">\(t^*-t\)</span>), such that <span class="math inline">\(z =\sum_{d=1}^{d=t^*-t} x_{t,d}\)</span> and <span class="math inline">\(\delta\)</span> be the cumulative sum of the delay
distribution, <span class="math inline">\(\pi(d)\)</span> up until <span class="math inline">\(d = t^*-t\)</span> such that <span class="math inline">\(\delta = \sum_{d=1}^{d=t^*-t} \pi(d)\)</span>. By
assuming that <span class="math inline">\(z \sim Bin(x_t,
\delta)\)</span> and <span class="math inline">\(x_t \sim Unif(0,
\inf)\)</span>, it can be shown that the expected value of <span class="math inline">\(x_t\)</span>, the total number of reported cases
on reference time <span class="math inline">\(t\)</span>, can be written
as:</p>
<p><span class="math display">\[
E(x_t | z, \delta) = \hat{x}_t = \frac{z + 1 - \delta}{\delta}
\]</span></p>
<p>Then we can compute <span class="math inline">\(\hat{x}_{t,d}\)</span> directly using the <span class="math inline">\(d\)</span>th element of <span class="math inline">\(\pi(d)\)</span></p>
<p><span class="math display">\[
\hat{x}_{t,d} = \pi(d) \times \hat{x}_t
\]</span></p>
<p>Where the number of reports at timepoint <span class="math inline">\(t\)</span> with delay <span class="math inline">\(d\)</span> is the product of the the expected
total reports, <span class="math inline">\(\hat{x}_t\)</span> and the
proportion expected at that particular delay <span class="math inline">\(d\)</span>, <span class="math inline">\(\pi(d)\)</span>.</p>
<p>The <code><a href="../reference/apply_delay.html">apply_delay()</a></code> function ingests a reporting triangle
or an incomplete reporting matrix and a delay PMF and returns a point
nowcast matrix.</p>
</div>
<div class="section level2">
<h2 id="estimate-of-dispersion">Estimate of dispersion<a class="anchor" aria-label="anchor" href="#estimate-of-dispersion"></a>
</h2>
<p>To estimate the uncertainty in the nowcasts, we use past nowcast
errors and assume a negative binomial observation model.</p>
<div class="section level3">
<h3 id="generation-of-retrospective-reporting-triangles">Generation of retrospective reporting triangles<a class="anchor" aria-label="anchor" href="#generation-of-retrospective-reporting-triangles"></a>
</h3>
<p>We describe a method which generates retrospective reporting
triangles to replicate what would have been available as of time <span class="math inline">\(t^*=s^*\)</span>, where <span class="math inline">\(s^* = t^*-m\)</span> for <span class="math inline">\(m = 1, 2, ... M\)</span> to generate <span class="math inline">\(M\)</span> retrospective reporting triangles.</p>
<p>To generate the set of <span class="math inline">\(M\)</span>
reporting triangles, we work backwards from most recent to oldest,
removing the last <span class="math inline">\(m\)</span> rows of the
existing reporting triangle, to generate <span class="math inline">\(M\)</span> truncated reporting triangles. These
can be generated from a reporting triangle with the function
<code><a href="../reference/truncate_triangles.html">truncate_triangles()</a></code> which ingests a single reporting
triangle and returns a list of <code>n</code> truncated reporting
containing only observations and missing values if present. We then
replace the bottom right triangle with NAs, assuming these would not
have been observed as of <span class="math inline">\(s^*\)</span>, using
the function <code><a href="../reference/generate_triangles.html">generate_triangles()</a></code> which returns a list of
<code>n</code> retrospective reporting triangles, again in order from
most recent to oldest.</p>
<p>The method uses each retrospective reporting triangle to re-estimate
a delay distribution using the <span class="math inline">\(N\)</span>
preceding reference times of the retrospective reporting triangle before
<span class="math inline">\(s^*\)</span>, and recomputes a retrospective
point nowcast matrix, for <span class="math inline">\(M\)</span>
realizations of the retrospective reporting triangle (so <span class="math inline">\(M\)</span> different <span class="math inline">\(s^*\)</span> values).</p>
<p>Thus in order to estimate uncertainty using <span class="math inline">\(N\)</span> reference times, the total training
volume must meet or exceed <span class="math inline">\(N+M\)</span> so
that the oldest retrospective nowcast dataset at <span class="math inline">\(s^* = t^*-M\)</span> can use <span class="math inline">\(N\)</span> reference times for its point
nowcast.</p>
</div>
<div class="section level3">
<h3 id="generation-of-retrospective-point-nowcast-matrices">Generation of retrospective point nowcast matrices<a class="anchor" aria-label="anchor" href="#generation-of-retrospective-point-nowcast-matrices"></a>
</h3>
<p>From the <span class="math inline">\(M\)</span> reporting triangles,
we apply the method described above to estimate a delay distribution
from a reporting triangle and generate a point nowcast for each
reporting triangle, to generate <span class="math inline">\(M\)</span>
point nowcasts. The function <code>generate_point_nowcasts()</code>
ingests the list of reporting triangles, estimates a delay distribution
for each, and generates a list of point nowcast matrices.</p>
</div>
<div class="section level3">
<h3 id="fit-predicted-point-nowcast-vectors-and-observed-counts-to-a-negative-binomial-observation-model-at-each-forecast-horizon">Fit predicted point nowcast vectors and observed counts to a
negative binomial observation model at each forecast horizon<a class="anchor" aria-label="anchor" href="#fit-predicted-point-nowcast-vectors-and-observed-counts-to-a-negative-binomial-observation-model-at-each-forecast-horizon"></a>
</h3>
<p>We quantify the uncertainty at the target quantity level, which is
assumed, by default, to be the final count at each reference time,
summed across reporting delays.</p>
<p>At each retrospective nowcast time <span class="math inline">\(s^*\)</span>, we compute the predicted and
corresponding observed nowcast at each forecast horizon <span class="math inline">\(j = 1, ..., D\)</span> by summing across the
reporting delays for all delays <span class="math inline">\(d\)</span>
that have been observed as of time <span class="math inline">\(t^*\)</span>, as indicated below by the indicator
function. We define the predicted nowcast for forecast horizon <span class="math inline">\(j\)</span> at retrospective nowcast time <span class="math inline">\(s^*\)</span> <span class="math display">\[
\hat{X}_{t-j}(s^*) = \sum_{d=0}^{D} \hat{X}_{t-j,d}(s^*) \times I(t-j+d
\leq t^*)
\]</span> and likewise the observed nowcast for forecast horizon <span class="math inline">\(j\)</span> at retrospective nowcast time <span class="math inline">\(s^*\)</span> <span class="math display">\[
X_{t-j}(s^*) = \sum_{d=0}^{D} X_{t-j,d}(s^*) \times I(t-j+d \leq t^*)
\]</span></p>
<p>This generates <span class="math inline">\(M\)</span> pairs of
predicted nowcasts and observed nowcasts for each forecast horizon <span class="math inline">\(j = 1, ..., D\)</span>. We assume that the
observed nowcasts <span class="math inline">\(X_{t-j}\)</span> follow a
negative binomial observation model with a mean of <span class="math inline">\(\hat{X}_{t-j}(t^*-j)\)</span></p>
<p><span class="math display">\[
X_{t-j} | \hat{X}_{t-j}(t^* - j) \sim NegBin(\mu = \hat{X}_{t-j}(t^*-j)
+ 0.1, \phi = \phi_{t^*-t})
\]</span> for all <span class="math inline">\(s^* = 1, ...,
M\)</span>.</p>
<p>We add a small number (0.1) to the mean to avoid an ill-defined
negative binomial.</p>
<p>The function <code><a href="../reference/estimate_dispersion.html">estimate_dispersion()</a></code> ingests a list of
reporting triangles representing the data available for each reference
time, a list of point nowcast matrices representing the nowcasts for
each reference time, and a list of truncated reporting matrices
representing the observations for each reference time. It returns a
vector of negative binomial dispersion parameters indexed starting at
forecast horizon <span class="math inline">\(j = 1\)</span>.</p>
</div>
</div>
<div class="section level2">
<h2 id="generate-probabilistic-nowcasts">Generate probabilistic nowcasts<a class="anchor" aria-label="anchor" href="#generate-probabilistic-nowcasts"></a>
</h2>
<p>Using the dispersion parameters for each forecast horizon, <span class="math inline">\(\phi(j),\)</span> for <span class="math inline">\(j = 1,...D\)</span>, we can generate probabilistic
nowcast matrices by drawing samples from the negative binomial:</p>
<p><span class="math display">\[
X_{t^*-j} \sim NegBin(\mu = \hat{X}_{t^*-j}, \phi = \phi(j))
\]</span></p>
<p>We can sample for any number of draws, and then use the draws to
compute any desired quantiles to summarize the outputs.</p>
<p>The function <code><a href="../reference/get_nowcast_pred_draws.html">get_nowcast_pred_draws()</a></code> ingests a point
nowcast prediction matrix (containing only the predicted elements, not
the observations in the reporting triangle), the dispersion parameters,
and the number of draws to sample and generates a dataframe of predicted
point nowcasts for each reference time. We can then join this to the
original data in long form by reference date and reporting date in order
to generate the probabilistic nowcasts as the sum of the predicted total
count from each draw and the observed count for each reference time as
of the final reference time.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kaitlyn Johnson, <a href="https://www.samabbott.co.uk/" class="external-link">Sam Abbott</a>, Johannes Bracher, Sebastian Funk.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
