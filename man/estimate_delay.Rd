% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/estimate_delay.R
\name{estimate_delay}
\alias{estimate_delay}
\title{Estimate a delay distribution from a reporting triangle}
\usage{
estimate_delay(
  reporting_triangle,
  n = nrow(reporting_triangle),
  preprocess = preprocess_negative_values
)
}
\arguments{
\item{reporting_triangle}{A \link{reporting_triangle} object with rows
representing reference times and columns representing delays.
Can be a reporting matrix or incomplete reporting matrix.
Can also be a ragged reporting triangle, where multiple columns are
reported for the same row (e.g., weekly reporting of daily data).}

\item{n}{Integer indicating the number of reference times (observations) to
be used in the estimate of the reporting delay, always starting from the
most recent reporting delay. The default is to use the whole reporting
triangle, so \code{nrow(reporting_triangle)}.}

\item{preprocess}{Function to apply to the truncated triangle before
estimation, or NULL to skip preprocessing. Default is
\code{\link[=preprocess_negative_values]{preprocess_negative_values()}}, which handles negative values by
redistributing them to earlier delays. Set to NULL if you want to preserve
negative PMF entries (e.g., when working with downward corrections where
negative probabilities reflect systematic adjustments).}
}
\value{
Vector indexed at 0 of length \code{ncol(reporting_triangle)} with
columns indicating the point estimate of the empirical probability
mass on each delay.
}
\description{
Provides an estimate of the reporting delay as a function
of the delay, based on the reporting triangle and the number of reference
date observations to be used in the estimation. This point estimate of the
delay is computed empirically, using an iterative algorithm starting from
the most recent observations. Use \code{\link[=truncate_to_delay]{truncate_to_delay()}} if you want to
limit the maximum delay before estimation.
This code was adapted from code written (under an MIT license)
by the Karlsruhe Institute of Technology RESPINOW
German Hospitalization Nowcasting Hub.
Modified from: https://github.com/KITmetricslab/RESPINOW-Hub/blob/7cce3ae2728116e8c8cc0e4ab29074462c24650e/code/baseline/functions.R#L55 #nolint
}
\examples{
# Example 1: Standard usage with default preprocessing
triangle_mat <- matrix(
  c(
    80, 50, 25, 10,
    100, 50, 30, 20,
    90, 45, 25, NA,
    80, 40, NA, NA,
    70, NA, NA, NA
  ),
  nrow = 5,
  byrow = TRUE
)
ref_dates <- seq(
  from = as.Date("2025-01-01"),
  by = "day",
  length.out = nrow(triangle_mat)
)
triangle <- as_reporting_triangle(
  data = triangle_mat,
  reference_dates = ref_dates,
  max_delay = 3
)
delay_pmf <- estimate_delay(
  reporting_triangle = triangle,
  n = 4
)
delay_pmf

# Example 2: Using data with downward corrections without preprocessing
# This preserves negative PMF entries reflecting systematic corrections
ref_dates_ex2 <- seq(
  from = as.Date("2025-01-01"),
  by = "day",
  length.out = nrow(example_downward_corr_mat)
)
triangle_ex2 <- as_reporting_triangle(
  data = example_downward_corr_mat,
  reference_dates = ref_dates_ex2,
  max_delay = 3
)
delay_pmf_negative <- estimate_delay(
  reporting_triangle = triangle_ex2,
  n = 5,
  preprocess = NULL
)
delay_pmf_negative
# Note: PMF may contain negative values and not sum to 1
sum(delay_pmf_negative)
}
\seealso{
Delay distribution estimation functions
\code{\link{preprocess_negative_values}()}
}
\concept{estimate_delay}
