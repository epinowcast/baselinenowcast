% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/estimate_uncertainty_parameters.R
\name{estimate_uncertainty_parameters}
\alias{estimate_uncertainty_parameters}
\title{Estimate uncertainty parameters for nowcasting}
\usage{
estimate_uncertainty_parameters(
  reporting_triangle,
  n_delay = NULL,
  n_retro = 2,
  max_delay = ncol(reporting_triangle) - 1,
  delay_pmf = NULL,
  ref_time_aggregator = identity,
  delay_aggregator = function(x) rowSums(x, na.rm = TRUE),
  structure = 1,
  uncertainty_model = fit_by_horizon
)
}
\arguments{
\item{reporting_triangle}{A reporting triangle matrix with reference dates
as rows and delays as columns. Should be the output of
\code{\link[=construct_triangle]{construct_triangle()}} or a compatible matrix structure with NAs in the
bottom right triangle.}

\item{n_delay}{Integer. Number of past observations (rows) to use for
estimating the delay distribution in each retrospective snapshot.
Default is to use all available rows in the smallest retrospective
triangle.}

\item{n_retro}{Integer. Number of retrospective snapshots to generate for
uncertainty estimation. Default is 2.}

\item{max_delay}{Integer. Maximum delay to consider in days. Default is
\code{ncol(reporting_triangle) - 1}.}

\item{delay_pmf}{Numeric vector or NULL. Optional custom delay probability
mass function. If NULL (default), the delay distribution is estimated
from the data.}

\item{ref_time_aggregator}{Function that operates along the rows (reference
times) of the retrospective point nowcast matrix before it has been
aggregated across columns (delays). Default is \code{identity} which does not
aggregate across reference times.}

\item{delay_aggregator}{Function that operates along the columns (delays)
of the retrospective point nowcast matrix after it has been aggregated
across reference times. Default is \code{function(x) rowSums(x, na.rm = TRUE)}.}

\item{structure}{Integer or vector specifying the reporting structure for
retrospective triangles. If integer, divides columns evenly. If vector,
must sum to number of columns minus 1. Default is 1 (standard triangular
structure).}

\item{uncertainty_model}{Function that ingests a matrix of observations and
a matrix of predictions and returns a vector that can be used to apply
uncertainty using the same error model. Default is \link{fit_by_horizon}.}
}
\value{
A numeric vector of uncertainty parameters with length equal to
one less than the number of columns in the reporting triangle, with each
element representing the estimate of the uncertainty parameter for each
horizon. Returns NULL if insufficient data is available for estimation.
}
\description{
Estimates uncertainty parameters for uncertainty quantification in nowcasts
by generating retrospective snapshots, creating reporting triangles,
producing point nowcasts, and estimating uncertainty from the nowcast
performance.

This function wraps the workflow of:
\enumerate{
\item \code{\link[=truncate_triangles]{truncate_triangles()}} - Create retrospective snapshots
\item \code{\link[=construct_triangles]{construct_triangles()}} - Generate retrospective reporting triangles
\item \code{\link[=fill_triangles]{fill_triangles()}} - Generate point nowcasts
\item \code{\link[=estimate_uncertainty]{estimate_uncertainty()}} - Estimate uncertainty parameters
}
}
\examples{
# Create example reporting triangle
triangle <- matrix(
  c(
    65, 46, 21, 7,
    70, 40, 20, 5,
    80, 50, 10, 10,
    100, 40, 31, 20,
    95, 45, 21, NA,
    82, 42, NA, NA,
    70, NA, NA, NA
  ),
  nrow = 7,
  byrow = TRUE
)

# Estimate uncertainty parameters with defaults
uncertainty_params <- estimate_uncertainty_parameters(triangle)

# Estimate with custom parameters
uncertainty_params <- estimate_uncertainty_parameters(
  triangle,
  n_delay = 5,
  n_retro = 3,
  max_delay = 3
)
}
