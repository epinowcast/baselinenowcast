% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/estimate_uncertainty_parameters.R
\name{estimate_uncertainty_parameters}
\alias{estimate_uncertainty_parameters}
\title{Estimate uncertainty parameters for nowcasting}
\usage{
estimate_uncertainty_parameters(
  reporting_triangle,
  n_delay = NULL,
  n_retro = 2,
  max_delay = ncol(reporting_triangle) - 1,
  delay_pmf = NULL,
  fun_to_aggregate = sum,
  k = 1,
  structure = 1
)
}
\arguments{
\item{reporting_triangle}{A reporting triangle matrix with reference dates
as rows and delays as columns. Should be the output of
\code{\link[=generate_triangle]{generate_triangle()}} or a compatible matrix structure with NAs in the
bottom right triangle.}

\item{n_delay}{Integer. Number of past observations (rows) to use for
estimating the delay distribution in each retrospective snapshot.
Default is to use all available rows in the smallest retrospective
triangle.}

\item{n_retro}{Integer. Number of retrospective snapshots to generate for
dispersion estimation. Default is 2.}

\item{max_delay}{Integer. Maximum delay to consider in days. Default is
\code{ncol(reporting_triangle) - 1}.}

\item{delay_pmf}{Numeric vector or NULL. Optional custom delay probability
mass function. If NULL (default), the delay distribution is estimated
from the data.}

\item{fun_to_aggregate}{Function. Function to aggregate counts when
estimating dispersion. Default is \code{sum}. Currently only \code{sum} is
supported.}

\item{k}{Integer. Number of reference times to apply the
\code{fun_to_aggregate} over to create target used to compute the nowcast
errors. Default is 1.}

\item{structure}{Integer or vector specifying the reporting structure for
retrospective triangles. If integer, divides columns evenly. If vector,
must sum to number of columns minus 1. Default is 1 (standard triangular
structure).}
}
\value{
A numeric vector of dispersion parameters with length equal to
one less than the number of columns in the reporting triangle, with each
element representing the estimate of the dispersion parameter for each
delay d, starting at delay d=1. Returns NULL if insufficient data is
available for estimation.
}
\description{
Estimates dispersion parameters for uncertainty quantification in nowcasts
by generating retrospective snapshots, creating reporting triangles,
producing point nowcasts, and estimating dispersion from the nowcast
performance.

This function wraps the workflow of:
\enumerate{
\item \code{\link[=truncate_triangles]{truncate_triangles()}} - Create retrospective snapshots
\item \code{\link[=generate_triangles]{generate_triangles()}} - Generate retrospective reporting triangles
\item \code{\link[=generate_pt_nowcast_mat_list]{generate_pt_nowcast_mat_list()}} - Generate point nowcasts
\item \code{\link[=estimate_dispersion]{estimate_dispersion()}} - Estimate dispersion parameters
}
}
\examples{
# Create example reporting triangle
triangle <- matrix(
  c(
    65, 46, 21, 7,
    70, 40, 20, 5,
    80, 50, 10, 10,
    100, 40, 31, 20,
    95, 45, 21, NA,
    82, 42, NA, NA,
    70, NA, NA, NA
  ),
  nrow = 7,
  byrow = TRUE
)

# Estimate uncertainty parameters with defaults
dispersion <- estimate_uncertainty_parameters(triangle)

# Estimate with custom parameters
dispersion <- estimate_uncertainty_parameters(
  triangle,
  n_delay = 5,
  n_retro = 3,
  max_delay = 3,
  k = 2
)
}
