% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/estimate_uncertainty_retro.R
\name{estimate_uncertainty_retro}
\alias{estimate_uncertainty_retro}
\title{Estimate uncertainty parameters using retrospective nowcasts}
\usage{
estimate_uncertainty_retro(
  reporting_triangle,
  n_history_delay,
  n_retrospective_nowcasts,
  max_delay = ncol(reporting_triangle) - 1,
  delay_pmf = NULL,
  ref_time_aggregator = identity,
  delay_aggregator = function(x) rowSums(x, na.rm = TRUE),
  structure = 1,
  uncertainty_model = fit_by_horizon
)
}
\arguments{
\item{reporting_triangle}{Matrix of the reporting triangle, with rows
representing the time points of reference and columns representing the
delays. Can be a reporting matrix or incomplete reporting matrix.
Can also be a ragged reporting triangle, where multiple columns are
reported for the same row. (e.g. weekly reporting of daily data).}

\item{n_history_delay}{Integer indicating the number of reference times
(observations) to be used in the estimate of the reporting delay, always
starting from the most recent reporting delay.}

\item{n_retrospective_nowcasts}{Integer indicating the number of
retrospective nowcast times to use for uncertainty estimation.}

\item{max_delay}{Integer indicating the maximum delay to estimate, in units
of the delay. The default is to use the whole reporting triangle,
\code{ncol(reporting_triangle) -1}.}

\item{delay_pmf}{Numeric vector representing a discrete probability mass
function for the delay distribution. If NULL (default), the delay
distribution is estimated from the data.}

\item{ref_time_aggregator}{Function that operates along the rows (reference
times) of the retrospective point nowcast matrix before it has been
aggregated across columns (delays). Default is \code{identity}
which does not aggregate across reference times.}

\item{delay_aggregator}{Function that operates along the columns (delays)
of the retrospective point nowcast matrix after it has been aggregated
across reference times. Default is \code{function(x) rowSums(x, na.rm = TRUE)}.}

\item{structure}{Integer or vector specifying the reporting structure.
If integer, divides columns evenly by that integer (with last possibly
truncated).  If vector, the sum must not be greater than or equal to the
number of columns. Default is 1 (standard triangular structure).}

\item{uncertainty_model}{Function that ingests a matrix of observations and a
matrix of predictions and returns a vector that can be used to
apply uncertainty using the same error model. Default is
\code{fit_by_horizon} with arguments of \code{obs} matrix of observations and
\code{pred} the matrix of predictions that fits each column (horizon)
to a negative binomial observation model by default. The user can
specify a different fitting model by replacing the
\code{fit_model} argument in \code{fit_by_horizon}.}
}
\value{
A numeric vector of uncertainty parameters with length equal to
one less than the number of columns in the reporting triangle, with each
element representing the estimate of the uncertainty parameter for each
horizon. Returns NULL if insufficient data is available for estimation.
}
\description{
Estimates uncertainty parameters for nowcasting by creating a series of
retrospective datasets from the input reporting triangle, generating point
nowcasts for those datasets, and calibrating uncertainty parameters based
on retrospective nowcast performance.

This function chains the retrospective nowcasting workflow:
\enumerate{
\item \code{\link[=truncate_triangles]{truncate_triangles()}} - Create retrospective snapshots
\item \code{\link[=construct_triangles]{construct_triangles()}} - Generate retrospective reporting triangles
\item \code{\link[=fill_triangles]{fill_triangles()}} - Generate point nowcasts
\item \code{\link[=estimate_uncertainty]{estimate_uncertainty()}} - Estimate uncertainty parameters
}

For full probabilistic nowcasts (uncertainty estimation + sampling), use
\code{\link[=estimate_and_apply_uncertainty]{estimate_and_apply_uncertainty()}}.

For more control over individual steps (e.g., custom matrix preparation,
alternative aggregation), use the low-level functions directly.
}
\examples{
# Create example reporting triangle
triangle <- matrix(
  c(
    65, 46, 21, 7,
    70, 40, 20, 5,
    80, 50, 10, 10,
    100, 40, 31, 20,
    95, 45, 21, NA,
    82, 42, NA, NA,
    70, NA, NA, NA
  ),
  nrow = 7,
  byrow = TRUE
)

# Estimate uncertainty parameters
uncertainty_params <- estimate_uncertainty_retro(
  triangle,
  n_history_delay = 5,
  n_retrospective_nowcasts = 2
)
uncertainty_params

# Estimate with custom parameters
uncertainty_params_custom <- estimate_uncertainty_retro(
  triangle,
  n_history_delay = 4,
  n_retrospective_nowcasts = 2,
  max_delay = 3
)
uncertainty_params_custom
}
