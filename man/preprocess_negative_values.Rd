% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/handle_neg_vals.R
\name{preprocess_negative_values}
\alias{preprocess_negative_values}
\title{Preprocess negative values in the reporting triangle}
\usage{
preprocess_negative_values(triangle)
}
\arguments{
\item{triangle}{Matrix of the reporting triangle, with rows representing
the time points of reference and columns representing the delays.}
}
\value{
Matrix of positive integers with negative values of reporting
handled via redistribution to earlier delays.
}
\description{
Takes in a reporting triangle and returns a matrix in the same format
as the input triangle, but with negative values of reporting handled by
redistributing them to earlier delays (from longer delay to shorter).
This is useful when dealing with reporting corrections that can result in
negative incremental counts.

When negative values are detected, they are set to zero and the negative
amount is subtracted from the count at the next earlier delay (moving from
right to left in each row). This process continues until either the
negative value is fully absorbed or the first delay is reached.

This code was adapted from code written (under an MIT license)
by the Karlsruhe Institute of Technology RESPINOW
German Hospitalization Nowcasting Hub.
Modified from https://github.com/KITmetricslab/RESPINOW-Hub/blob/main/code/baseline/functions.R #nolint
}
\details{
Use this function when:
\itemize{
\item Your data contains reporting corrections that result in negative counts
\item You want to preserve the total count while handling negatives
\item You need a delay distribution that sums to 1 or a CDF that is weakly
increasing
}

Set \code{preprocess = NULL} in \code{\link[=estimate_delay]{estimate_delay()}} when:
\itemize{
\item Your data naturally has negative PMF entries (e.g., from differencing)
\item You want to preserve the original structure including negatives
\item You are working with corrections that should be reflected as negative
probabilities
}
}
\examples{
# Triangle with negative values from corrections
triangle_with_neg <- matrix(c(
  10, 5, -2, 3,
  8, -3, 4, 2,
  1, 6, 3, -1
), nrow = 3, byrow = TRUE)

# Preprocess to handle negatives
preprocessed <- preprocess_negative_values(triangle_with_neg)
preprocessed
}
\seealso{
Delay distribution estimation functions
\code{\link{estimate_delay}()}
}
\concept{estimate_delay}
