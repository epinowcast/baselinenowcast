<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Estimate and apply uncertainty to a point nowcast matrix — estimate_and_apply_uncertainty • baselinenowcast</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate and apply uncertainty to a point nowcast matrix — estimate_and_apply_uncertainty"><meta name="description" content="Generates probabilistic nowcasts by estimating uncertainty parameters from
retrospective nowcasts and applying them to a point nowcast matrix.
This function combines:
estimate_uncertainty_retro() - Estimates uncertainty parameters
using retrospective nowcasts
sample_nowcasts() - Applies uncertainty to generate draws


To obtain estimates of uncertainty parameters, use
estimate_uncertainty_retro(). For full control over individual steps
(e.g., custom matrix preparation, alternative aggregation), use the
low-level functions (truncate_to_rows(),
apply_reporting_structure(),
fill_triangles(), estimate_uncertainty()) directly."><meta property="og:description" content="Generates probabilistic nowcasts by estimating uncertainty parameters from
retrospective nowcasts and applying them to a point nowcast matrix.
This function combines:
estimate_uncertainty_retro() - Estimates uncertainty parameters
using retrospective nowcasts
sample_nowcasts() - Applies uncertainty to generate draws


To obtain estimates of uncertainty parameters, use
estimate_uncertainty_retro(). For full control over individual steps
(e.g., custom matrix preparation, alternative aggregation), use the
low-level functions (truncate_to_rows(),
apply_reporting_structure(),
fill_triangles(), estimate_uncertainty()) directly."><meta property="og:image" content="https://baselinenowcast.epinowcast.org/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">baselinenowcast</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.1000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/baselinenowcast.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/baselinenowcast.html">Getting started</a></li>
    <li><a class="dropdown-item" href="../articles/modular_workflow.html">Modular workflow demonstration</a></li>
    <li><a class="dropdown-item" href="../articles/model_definition.html">Mathematical model</a></li>
    <li><a class="dropdown-item" href="../articles/nomenclature.html">Nomenclature</a></li>
    <li><a class="dropdown-item" href="../articles/nssp_nowcast.html">A case study nowcasting applied to the U.S. National Syndromic Surveillance Program (NSSP) data</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epinowcast/baselinenowcast/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Estimate and apply uncertainty to a point nowcast matrix</h1>
      <small class="dont-index">Source: <a href="https://github.com/epinowcast/baselinenowcast/blob/main/R/estimate_and_apply_uncertainty.R" class="external-link"><code>R/estimate_and_apply_uncertainty.R</code></a></small>
      <div class="d-none name"><code>estimate_and_apply_uncertainty.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Generates probabilistic nowcasts by estimating uncertainty parameters from
retrospective nowcasts and applying them to a point nowcast matrix.</p>
<p>This function combines:</p><ol><li><p><code><a href="estimate_uncertainty_retro.html">estimate_uncertainty_retro()</a></code> - Estimates uncertainty parameters
using retrospective nowcasts</p></li>
<li><p><code><a href="sample_nowcasts.html">sample_nowcasts()</a></code> - Applies uncertainty to generate draws</p></li>
</ol><p>To obtain estimates of uncertainty parameters, use
<code><a href="estimate_uncertainty_retro.html">estimate_uncertainty_retro()</a></code>. For full control over individual steps
(e.g., custom matrix preparation, alternative aggregation), use the
low-level functions (<code><a href="truncate_to_rows.html">truncate_to_rows()</a></code>,
<code><a href="apply_reporting_structure.html">apply_reporting_structure()</a></code>,
<code><a href="fill_triangles.html">fill_triangles()</a></code>, <code><a href="estimate_uncertainty.html">estimate_uncertainty()</a></code>) directly.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">estimate_and_apply_uncertainty</span><span class="op">(</span></span>
<span>  <span class="va">point_nowcast_matrix</span>,</span>
<span>  <span class="va">reporting_triangle</span>,</span>
<span>  <span class="va">n_history_delay</span>,</span>
<span>  <span class="va">n_retrospective_nowcasts</span>,</span>
<span>  structure <span class="op">=</span> <span class="fu"><a href="get_reporting_structure.html">get_reporting_structure</a></span><span class="op">(</span><span class="va">reporting_triangle</span><span class="op">)</span>,</span>
<span>  draws <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  delay_pmf <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  uncertainty_model <span class="op">=</span> <span class="va">fit_by_horizon</span>,</span>
<span>  uncertainty_sampler <span class="op">=</span> <span class="va">sample_nb</span>,</span>
<span>  validate <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-point-nowcast-matrix">point_nowcast_matrix<a class="anchor" aria-label="anchor" href="#arg-point-nowcast-matrix"></a></dt>
<dd><p>Matrix of point nowcast predictions and
observations, with rows representing the reference times and columns
representing the delays.</p></dd>


<dt id="arg-reporting-triangle">reporting_triangle<a class="anchor" aria-label="anchor" href="#arg-reporting-triangle"></a></dt>
<dd><p>A <a href="reporting_triangle-class.html">reporting_triangle</a> object with rows
representing reference times and columns representing delays.
Can be a reporting matrix or incomplete reporting matrix.
Can also be a ragged reporting triangle, where multiple columns are
reported for the same row (e.g., weekly reporting of daily data).</p></dd>


<dt id="arg-n-history-delay">n_history_delay<a class="anchor" aria-label="anchor" href="#arg-n-history-delay"></a></dt>
<dd><p>Integer indicating the number of reference times
(observations) to be used in the estimate of the reporting delay, always
starting from the most recent reporting delay.</p></dd>


<dt id="arg-n-retrospective-nowcasts">n_retrospective_nowcasts<a class="anchor" aria-label="anchor" href="#arg-n-retrospective-nowcasts"></a></dt>
<dd><p>Integer indicating the number of
retrospective nowcast times to use for uncertainty estimation.</p></dd>


<dt id="arg-structure">structure<a class="anchor" aria-label="anchor" href="#arg-structure"></a></dt>
<dd><p>Integer or vector specifying the reporting structure.
If integer, divides columns evenly by that integer (with last possibly
truncated).  If vector, the sum must not be greater than or equal to the
number of columns. Default is 1 (standard triangular structure).</p></dd>


<dt id="arg-draws">draws<a class="anchor" aria-label="anchor" href="#arg-draws"></a></dt>
<dd><p>Integer indicating the number of draws of the predicted
nowcast vector to generate. Default is <code>1000</code>.</p></dd>


<dt id="arg-delay-pmf">delay_pmf<a class="anchor" aria-label="anchor" href="#arg-delay-pmf"></a></dt>
<dd><p>Vector or list of vectors of delays assumed to be indexed
starting at the first delay column in each of the matrices in
<code>retro_reporting_triangles</code>. If a list, must of the same length as
<code>retro_reporting_triangles</code>, with elements aligning. Default is <code>NULL</code></p></dd>


<dt id="arg-uncertainty-model">uncertainty_model<a class="anchor" aria-label="anchor" href="#arg-uncertainty-model"></a></dt>
<dd><p>Function that ingests a matrix of observations and a
matrix of predictions and returns a vector that can be used to
apply uncertainty using the same error model. Default is
<code>fit_by_horizon</code> with arguments of <code>obs</code> matrix of observations and
<code>pred</code> the matrix of predictions that fits each column (horizon)
to a negative binomial observation model by default. The user can
specify a different fitting model by replacing the
<code>fit_model</code> argument in <code>fit_by_horizon</code>.</p></dd>


<dt id="arg-uncertainty-sampler">uncertainty_sampler<a class="anchor" aria-label="anchor" href="#arg-uncertainty-sampler"></a></dt>
<dd><p>Function that ingests a vector or matrix of
predictions and a vector of uncertainty parameters and generates draws
from the observation model. Default is <code>sample_nb</code> which expects
arguments <code>pred</code> for the vector of predictions and uncertainty parameters
for the corresponding vector of uncertainty parameters, and draws from a
negative binomial for each element of the vector.</p></dd>


<dt id="arg-validate">validate<a class="anchor" aria-label="anchor" href="#arg-validate"></a></dt>
<dd><p>Logical. If TRUE (default), validates the object. Set to
FALSE only when called from functions that already validated.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments to <code><a href="estimate_uncertainty.html">estimate_uncertainty()</a></code> and
<code><a href="sample_prediction.html">sample_prediction()</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>nowcast_draws_df</code> Dataframe containing draws of combined
observations and probabilistic predictions at each reference time.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>High-level workflow wrapper functions
<code><a href="allocate_reference_times.html">allocate_reference_times()</a></code>,
<code><a href="estimate_and_apply_delay.html">estimate_and_apply_delay()</a></code>,
<code><a href="estimate_uncertainty_retro.html">estimate_uncertainty_retro()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Use package data truncated to appropriate size</span></span></span>
<span class="r-in"><span><span class="va">data_as_of</span> <span class="op">&lt;-</span> <span class="va">syn_nssp_df</span><span class="op">[</span><span class="va">syn_nssp_df</span><span class="op">$</span><span class="va">report_date</span> <span class="op">&lt;=</span> <span class="st">"2026-04-01"</span>, <span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">triangle</span> <span class="op">&lt;-</span> <span class="fu"><a href="as_reporting_triangle.html">as_reporting_triangle</a></span><span class="op">(</span><span class="va">data_as_of</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="truncate_to_delay.html">truncate_to_delay</a></span><span class="op">(</span>max_delay <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Using max_delay = 154 from data</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Truncating from max_delay = 154 to 25.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">pt_nowcast_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="estimate_and_apply_delay.html">estimate_and_apply_delay</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  reporting_triangle <span class="op">=</span> <span class="va">triangle</span>,</span></span>
<span class="r-in"><span>  n <span class="op">=</span> <span class="fl">75</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Use 75 reference times for delay estimation and 40 for uncertainty</span></span></span>
<span class="r-in"><span><span class="va">nowcast_draws_df</span> <span class="op">&lt;-</span> <span class="fu">estimate_and_apply_uncertainty</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">pt_nowcast_matrix</span>,</span></span>
<span class="r-in"><span>  <span class="va">triangle</span>,</span></span>
<span class="r-in"><span>  n_history_delay <span class="op">=</span> <span class="fl">75</span>,</span></span>
<span class="r-in"><span>  n_retrospective_nowcasts <span class="op">=</span> <span class="fl">40</span>,</span></span>
<span class="r-in"><span>  draws <span class="op">=</span> <span class="fl">100</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">nowcast_draws_df</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   pred_count reference_date draw</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        382     2025-10-25    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2        432     2025-10-26    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3        351     2025-10-27    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4        361     2025-10-28    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5        426     2025-10-29    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6        362     2025-10-30    1</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kaitlyn Johnson, Emily Tyszka, Johannes Bracher, Sebastian Funk, <a href="https://www.samabbott.co.uk/" class="external-link">Sam Abbott</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.9000.</p>
</div>

    </footer></div>





  </body></html>

