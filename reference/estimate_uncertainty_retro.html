<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Estimate uncertainty parameters using retrospective nowcasts — estimate_uncertainty_retro • baselinenowcast</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate uncertainty parameters using retrospective nowcasts — estimate_uncertainty_retro"><meta name="description" content="Estimates uncertainty parameters for nowcasting by creating a series of
retrospective datasets from the input reporting triangle, generating point
nowcasts for those datasets, and calibrating uncertainty parameters based
on retrospective nowcast performance.
This function chains the retrospective nowcasting workflow:
truncate_triangles() - Create retrospective snapshots
construct_triangles() - Generate retrospective reporting triangles
fill_triangles() - Generate point nowcasts
estimate_uncertainty() - Estimate uncertainty parameters


For full probabilistic nowcasts (uncertainty estimation + sampling), use
estimate_and_apply_uncertainty().
For more control over individual steps (e.g., custom matrix preparation,
alternative aggregation), use the low-level functions directly."><meta property="og:description" content="Estimates uncertainty parameters for nowcasting by creating a series of
retrospective datasets from the input reporting triangle, generating point
nowcasts for those datasets, and calibrating uncertainty parameters based
on retrospective nowcast performance.
This function chains the retrospective nowcasting workflow:
truncate_triangles() - Create retrospective snapshots
construct_triangles() - Generate retrospective reporting triangles
fill_triangles() - Generate point nowcasts
estimate_uncertainty() - Estimate uncertainty parameters


For full probabilistic nowcasts (uncertainty estimation + sampling), use
estimate_and_apply_uncertainty().
For more control over individual steps (e.g., custom matrix preparation,
alternative aggregation), use the low-level functions directly."><meta property="og:image" content="https://baselinenowcast.epinowcast.org/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">baselinenowcast</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.1000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/baselinenowcast.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/baselinenowcast.html">Getting started</a></li>
    <li><a class="dropdown-item" href="../articles/model_definition.html">Mathematical model</a></li>
    <li><a class="dropdown-item" href="../articles/nomenclature.html">Nomenclature</a></li>
    <li><a class="dropdown-item" href="../articles/nssp_nowcast.html">A case study nowcasting applied to the U.S. National Syndromic Surveillance Program (NSSP) data</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epinowcast/baselinenowcast/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Estimate uncertainty parameters using retrospective nowcasts</h1>
      <small class="dont-index">Source: <a href="https://github.com/epinowcast/baselinenowcast/blob/main/R/estimate_uncertainty_retro.R" class="external-link"><code>R/estimate_uncertainty_retro.R</code></a></small>
      <div class="d-none name"><code>estimate_uncertainty_retro.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Estimates uncertainty parameters for nowcasting by creating a series of
retrospective datasets from the input reporting triangle, generating point
nowcasts for those datasets, and calibrating uncertainty parameters based
on retrospective nowcast performance.</p>
<p>This function chains the retrospective nowcasting workflow:</p><ol><li><p><code><a href="truncate_triangles.html">truncate_triangles()</a></code> - Create retrospective snapshots</p></li>
<li><p><code><a href="construct_triangles.html">construct_triangles()</a></code> - Generate retrospective reporting triangles</p></li>
<li><p><code><a href="fill_triangles.html">fill_triangles()</a></code> - Generate point nowcasts</p></li>
<li><p><code><a href="estimate_uncertainty.html">estimate_uncertainty()</a></code> - Estimate uncertainty parameters</p></li>
</ol><p>For full probabilistic nowcasts (uncertainty estimation + sampling), use
<code><a href="estimate_and_apply_uncertainty.html">estimate_and_apply_uncertainty()</a></code>.</p>
<p>For more control over individual steps (e.g., custom matrix preparation,
alternative aggregation), use the low-level functions directly.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">estimate_uncertainty_retro</span><span class="op">(</span></span>
<span>  <span class="va">reporting_triangle</span>,</span>
<span>  <span class="va">n_history_delay</span>,</span>
<span>  <span class="va">n_retrospective_nowcasts</span>,</span>
<span>  max_delay <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">reporting_triangle</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>  structure <span class="op">=</span> <span class="fu"><a href="detect_structure.html">detect_structure</a></span><span class="op">(</span><span class="va">reporting_triangle</span><span class="op">)</span>,</span>
<span>  delay_pmf <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  preprocess <span class="op">=</span> <span class="va">preprocess_negative_values</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-reporting-triangle">reporting_triangle<a class="anchor" aria-label="anchor" href="#arg-reporting-triangle"></a></dt>
<dd><p>Matrix of the reporting triangle, with rows
representing the time points of reference and columns representing the
delays. Can be a reporting matrix or incomplete reporting matrix.
Can also be a ragged reporting triangle, where multiple columns are
reported for the same row. (e.g. weekly reporting of daily data).</p></dd>


<dt id="arg-n-history-delay">n_history_delay<a class="anchor" aria-label="anchor" href="#arg-n-history-delay"></a></dt>
<dd><p>Integer indicating the number of reference times
(observations) to be used in the estimate of the reporting delay, always
starting from the most recent reporting delay.</p></dd>


<dt id="arg-n-retrospective-nowcasts">n_retrospective_nowcasts<a class="anchor" aria-label="anchor" href="#arg-n-retrospective-nowcasts"></a></dt>
<dd><p>Integer indicating the number of
retrospective nowcast times to use for uncertainty estimation.</p></dd>


<dt id="arg-max-delay">max_delay<a class="anchor" aria-label="anchor" href="#arg-max-delay"></a></dt>
<dd><p>Integer indicating the maximum delay to estimate, in units
of the delay. The default is to use the whole reporting triangle,
<code>ncol(reporting_triangle) -1</code>.</p></dd>


<dt id="arg-structure">structure<a class="anchor" aria-label="anchor" href="#arg-structure"></a></dt>
<dd><p>Integer or vector specifying the reporting structure.
If integer, divides columns evenly by that integer (with last possibly
truncated).  If vector, the sum must not be greater than or equal to the
number of columns. Default is 1 (standard triangular structure).</p></dd>


<dt id="arg-delay-pmf">delay_pmf<a class="anchor" aria-label="anchor" href="#arg-delay-pmf"></a></dt>
<dd><p>Vector or list of vectors of delays assumed to be indexed
starting at the first delay column in each of the matrices in
<code>retro_reporting_triangles</code>. If a list, must of the same length as
<code>retro_reporting_triangles</code>, with elements aligning. Default is <code>NULL</code></p></dd>


<dt id="arg-preprocess">preprocess<a class="anchor" aria-label="anchor" href="#arg-preprocess"></a></dt>
<dd><p>Function to apply to the truncated triangle before
estimation, or NULL to skip preprocessing. Default is
<code><a href="preprocess_negative_values.html">preprocess_negative_values()</a></code>, which handles negative values by
redistributing them to earlier delays. Set to NULL if you want to preserve
negative PMF entries (e.g., when working with downward corrections where
negative probabilities reflect systematic adjustments).</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments passed to <code><a href="estimate_uncertainty.html">estimate_uncertainty()</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A numeric vector of uncertainty parameters with length equal to
one less than the number of columns in the reporting triangle, with each
element representing the estimate of the uncertainty parameter for each
horizon. Returns NULL if insufficient data is available for estimation.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>High-level workflow wrapper functions
<code><a href="allocate_reference_times.html">allocate_reference_times()</a></code>,
<code><a href="estimate_and_apply_delay.html">estimate_and_apply_delay()</a></code>,
<code><a href="estimate_and_apply_uncertainty.html">estimate_and_apply_uncertainty()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Create example reporting triangle</span></span></span>
<span class="r-in"><span><span class="va">triangle</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fl">65</span>, <span class="fl">46</span>, <span class="fl">21</span>, <span class="fl">7</span>,</span></span>
<span class="r-in"><span>    <span class="fl">70</span>, <span class="fl">40</span>, <span class="fl">20</span>, <span class="fl">5</span>,</span></span>
<span class="r-in"><span>    <span class="fl">80</span>, <span class="fl">50</span>, <span class="fl">10</span>, <span class="fl">10</span>,</span></span>
<span class="r-in"><span>    <span class="fl">100</span>, <span class="fl">40</span>, <span class="fl">31</span>, <span class="fl">20</span>,</span></span>
<span class="r-in"><span>    <span class="fl">95</span>, <span class="fl">45</span>, <span class="fl">21</span>, <span class="cn">NA</span>,</span></span>
<span class="r-in"><span>    <span class="fl">82</span>, <span class="fl">42</span>, <span class="cn">NA</span>, <span class="cn">NA</span>,</span></span>
<span class="r-in"><span>    <span class="fl">70</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  nrow <span class="op">=</span> <span class="fl">7</span>,</span></span>
<span class="r-in"><span>  byrow <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Estimate uncertainty parameters</span></span></span>
<span class="r-in"><span><span class="va">uncertainty_params</span> <span class="op">&lt;-</span> <span class="fu">estimate_uncertainty_retro</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">triangle</span>,</span></span>
<span class="r-in"><span>  n_history_delay <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>  n_retrospective_nowcasts <span class="op">=</span> <span class="fl">2</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">uncertainty_params</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 999.999936   5.078299   3.034222</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Estimate with custom parameters</span></span></span>
<span class="r-in"><span><span class="va">uncertainty_params_custom</span> <span class="op">&lt;-</span> <span class="fu">estimate_uncertainty_retro</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">triangle</span>,</span></span>
<span class="r-in"><span>  n_history_delay <span class="op">=</span> <span class="fl">4</span>,</span></span>
<span class="r-in"><span>  n_retrospective_nowcasts <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>  max_delay <span class="op">=</span> <span class="fl">3</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">uncertainty_params_custom</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 999.999908   2.985022   4.850320</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kaitlyn Johnson, Emily Tyszka, Johannes Bracher, Sebastian Funk, <a href="https://www.samabbott.co.uk/" class="external-link">Sam Abbott</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.9000.</p>
</div>

    </footer></div>





  </body></html>

